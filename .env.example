# Discourse RSS Feed
RSS_URL=https://discuss.criticalfallibilism.com/posts.rss
POLL_INTERVAL_SECS=60
CACHE_WINDOW_SECS=3600
# Maximum number of RSS pages to fetch per poll (default: 4)
# Discourse /posts.rss uses cursor-based pagination with 'before' parameter
# Each batch returns up to 50 posts (hard limit)
# Default of 4 pages fetches up to 200 posts per poll cycle
# Increase to 10+ for catching up on older posts during initial setup
RSS_MAX_PAGES=4

# Database
DATABASE_PATH=./data/archive.sqlite

# S3 Storage
S3_BUCKET=discourse-archives
S3_REGION=us-east-1
S3_ENDPOINT=                    # Optional, for MinIO/R2
S3_PREFIX=archives/
S3_PUBLIC_URL_BASE=             # Optional, for R2/custom domains (e.g., https://pub-xxxxx.r2.dev)
AWS_ACCESS_KEY_ID=your-access-key
AWS_SECRET_ACCESS_KEY=your-secret-key

# Archive Workers
WORKER_CONCURRENCY=4
PER_DOMAIN_CONCURRENCY=1
WORK_DIR=./data/tmp
YT_DLP_PATH=yt-dlp
GALLERY_DL_PATH=gallery-dl

# Path to cookies.txt for authenticated downloads (optional)
# COOKIES_FILE_PATH=/opt/discourse-link-archiver/cookies.txt
COOKIES_FILE_PATH=

# Optional: use a persisted browser profile instead of exporting cookies.txt.
# Example: chromium+basictext:/app/cookies/chromium-profile
YT_DLP_COOKIES_FROM_BROWSER=

# Delay between yt-dlp requests (YouTube, TikTok) to avoid 429 rate limits
# Default: 5000 (5 seconds). Only one yt-dlp operation runs at a time.
YOUTUBE_REQUEST_DELAY_MS=5000

# Comment Extraction (enabled by default)
# Extract and archive platform comments (YouTube, TikTok, Instagram)
# Note: Twitter comment extraction is disabled (causes account locks with yt-dlp)
COMMENTS_ENABLED=true
COMMENTS_MAX_COUNT=1000
COMMENTS_INCLUDE_REPLIES=true
# Comma-separated list of platforms to extract comments from
# Supported: youtube,tiktok,instagram,reddit (twitter disabled)
COMMENTS_PLATFORMS=youtube,tiktok,instagram
COMMENTS_MAX_DEPTH=3
COMMENTS_REQUEST_DELAY_MS=1000

# Archive Policy
ARCHIVE_MODE=deletable          # 'deletable' or 'all'
ARCHIVE_QUOTE_ONLY_LINKS=false

# Web Server
WEB_HOST=0.0.0.0
WEB_PORT=8080

# HTTPS / Let's Encrypt (disabled by default)
# Enable for automatic TLS certificates. Certs cached in TLS_CACHE_DIR.
TLS_ENABLED=false
TLS_DOMAINS=                      # Required when enabled, e.g., "example.com,www.example.com"
TLS_CONTACT_EMAIL=                # Optional, for cert expiry notifications
TLS_CACHE_DIR=./data/acme_cache   # Certificate cache (persists across restarts)
TLS_USE_STAGING=false             # Set true for testing (avoids Let's Encrypt rate limits)
TLS_HTTPS_PORT=443

# Wayback Machine Integration
WAYBACK_ENABLED=true
WAYBACK_RATE_LIMIT_PER_MIN=5

# Database Backup
BACKUP_ENABLED=true
BACKUP_INTERVAL_HOURS=24
BACKUP_RETENTION_COUNT=30

# Logging
RUST_LOG=info,discourse_link_archiver=debug

# IPFS Integration (Optional)
IPFS_ENABLED=false
IPFS_API_URL=http://127.0.0.1:5001
IPFS_GATEWAY_URLS=https://ipfs.io/ipfs/,https://dweb.link/ipfs/,https://gateway.pinata.cloud/ipfs/

# Manual Submission
SUBMISSION_ENABLED=true
SUBMISSION_RATE_LIMIT_PER_HOUR=60
